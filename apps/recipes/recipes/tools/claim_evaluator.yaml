# Claim Evaluator Recipe
# Evaluates memory claims for quality and relevance
#
# Used by context_builder.py for claim lifecycle management
# (keep_active, archive_cold, delete decisions).

name: tools_claim_evaluator
category: tools
role: claim_evaluator
model_layer: REFLEX  # Classification task uses REFLEX (temp 0.3)

# Prompt fragments (loaded in order)
prompt_fragments:
  - "apps/prompts/tools/claim_evaluator.md"

# Input documents
input_docs:
  - path: "claim_id"
    path_type: "runtime"
    optional: false
    max_tokens: 50
    description: "Unique claim identifier"

  - path: "statement"
    path_type: "runtime"
    optional: false
    max_tokens: 300
    description: "The claim text to evaluate"

  - path: "evidence"
    path_type: "runtime"
    optional: true
    max_tokens: 200
    description: "Evidence supporting the claim"

  - path: "confidence"
    path_type: "runtime"
    optional: true
    max_tokens: 20
    description: "Current confidence level"

  - path: "domain"
    path_type: "runtime"
    optional: true
    max_tokens: 50
    description: "Claim domain (pricing, research, etc.)"

  - path: "days_since_created"
    path_type: "runtime"
    optional: true
    max_tokens: 10
    description: "Age of the claim in days"

  - path: "session_context"
    path_type: "runtime"
    optional: true
    max_tokens: 300
    description: "Current session context (recent queries, active topics)"

# Output document
output_doc:
  path: "claim_evaluation.json"
  path_type: "temp"

# Token budget
token_budget:
  total: 1500
  prompt: 600       # claim_evaluator.md prompt
  input_docs: 700   # claim + context
  output: 200       # JSON evaluation
  buffer: 0

# Trimming strategy
trimming_strategy:
  method: intelligent_truncate
  priority:
    - keep: claim_id
    - keep: statement
    - keep: domain
    - keep: days_since_created
    - truncate: evidence
    - truncate: session_context

# Output schema
output_schema:
  type: object
  required:
    - _type
    - claim_id
    - quality_score
    - decision
    - confidence
    - reasoning
  properties:
    _type:
      type: string
      const: "CLAIM_EVALUATION"
    claim_id:
      type: string
    claim_text:
      type: string
    quality_score:
      type: integer
      minimum: 0
      maximum: 100
    decision:
      type: string
      enum: ["keep_active", "archive_cold", "delete"]
    confidence:
      type: number
      minimum: 0
      maximum: 1
    reasoning:
      type: string

# Quality gates
quality_gates:
  schema_validation: true
  max_retries: 2

# Description
description: |
  Claim Evaluator decides whether a memory claim should be kept, archived, or deleted.

  **Quality Scoring (0-100):**
  - Source credibility: 30%
  - Evidence strength: 25%
  - Recency: 20%
  - Session relevance: 25%

  **Decisions:**
  - score >= 60: keep_active (relevant, high quality)
  - score 40-59: archive_cold (potentially useful later)
  - score < 40: delete (obsolete, low quality)

  Input: claim details + session context
  Output: claim_evaluation.json with decision

# Integration
integration:
  invoked_by:
    - context_builder.evaluate_claim_with_llm
  invocation_point: during_memory_lifecycle_management
