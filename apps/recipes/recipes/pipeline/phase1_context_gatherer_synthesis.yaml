# Context Gatherer SYNTHESIS Phase Recipe
# Merged EXTRACT + COMPILE into single LLM call
#
# Token Budget: 5,000 tokens (vs 8,000 for EXTRACT + COMPILE combined)
# Savings: 37% per synthesis phase
#
# Key Features:
# - Single LLM call handles extraction (if links) AND compilation
# - Conditional prompt sections based on whether links exist
# - Outputs final context.md ยง2 directly

name: phase1_context_gatherer_synthesis
category: pipeline
phase: 2
role: MIND
temperature: 0.6

prompt_fragments:
  - "apps/prompts/pipeline/phase1_context_gatherer_synthesis.md"

token_budget:
  total: 5000
  prompt: 600       # System prompt + instructions
  input_docs: 3000  # retrieval_result + linked_docs + supplements
  output: 1200      # Markdown context.md ยง2
  buffer: 200

input_docs:
  - path: "retrieval_result.json"
    path_type: "turn"
    max_tokens: 800
    description: "Output from RETRIEVAL phase with direct_info"
  - path: "linked_docs"
    path_type: "memory"
    max_tokens: 1500
    optional: true
    description: "Content from followed links (optional)"
  - path: "supplementary"
    path_type: "memory"
    max_tokens: 700
    description: "Cache, research index, lessons, session memory"

output_doc:
  path: "context.md"
  section: "2"
  path_type: "turn"
  description: "Section 2: Gathered Context"

output_schema: GATHERED_CONTEXT
