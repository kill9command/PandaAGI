# Calibration Selector Generator Recipe
# Generates CSS selectors for product data extraction
#
# Used by SmartCalibrator to create page-specific extraction schemas

name: browser_calibration_selector_generator
category: browser
role: calibration
model_layer: MIND  # Reasoning task (temp 0.1 for structured output)

# Prompt fragments
prompt_fragments:
  - "apps/prompts/browser/calibration_selector_generator.md"

# Input documents
input_docs:
  - path: "page_url"
    path_type: "runtime"
    optional: false
    max_tokens: 200
    description: "URL of the page being calibrated"

  - path: "page_info"
    path_type: "runtime"
    optional: false
    max_tokens: 3000
    description: "Page analysis data (containers, patterns, elements)"

  - path: "previous_attempt"
    path_type: "runtime"
    optional: true
    max_tokens: 500
    description: "Previous failed schema and reason (for retry)"

# Output document
output_doc:
  path: "extraction_schema.json"
  path_type: "temp"

# Token budget
token_budget:
  total: 5000
  prompt: 800
  input_docs: 3700
  output: 500
  buffer: 0

# Output schema
output_schema:
  type: object
  required:
    - product_card_selector
    - price_selector
    - confidence
  properties:
    product_card_selector:
      type: string
    price_selector:
      type: string
    title_selector:
      type: string
    link_selector:
      type: string
    confidence:
      type: number
      minimum: 0
      maximum: 1
    reasoning:
      type: string

# Quality gates
quality_gates:
  schema_validation: true
  confidence_threshold: 0.4
  max_retries: 2

description: |
  Generates CSS selectors for extracting product data from retail pages.
  Uses page structure analysis to identify product cards, prices, titles, and links.

  Input: Page URL + analysis data (containers, patterns, elements)
  Output: CSS selectors for extraction

integration:
  invoked_by:
    - smart_calibrator.calibrate
  invocation_point: after_page_analysis
