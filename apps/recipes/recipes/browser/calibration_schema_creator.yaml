# Calibration Schema Creator Recipe
# Creates extraction schemas for retail page product extraction
#
# Used by LLMCalibrator to generate page-specific extraction rules

name: browser_calibration_schema_creator
category: browser
role: calibration
model_layer: MIND  # Reasoning task (temp 0.1 for structured output)

# Prompt fragments
prompt_fragments:
  - "apps/prompts/browser/calibration_schema_creator.md"

# Input documents
input_docs:
  - path: "site_intent"
    path_type: "runtime"
    optional: false
    max_tokens: 100
    description: "Site intent (e.g., search_results, product_list)"

  - path: "page_context"
    path_type: "runtime"
    optional: false
    max_tokens: 1500
    description: "Page context (URL, title, repeated elements, sample HTML)"

  - path: "previous_schema"
    path_type: "runtime"
    optional: true
    max_tokens: 500
    description: "Previous failed schema and feedback (for retry)"

# Output document
output_doc:
  path: "extraction_schema.json"
  path_type: "temp"

# Token budget
token_budget:
  total: 4500
  prompt: 1000
  input_docs: 3000
  output: 500
  buffer: 0

# Output schema
output_schema:
  type: object
  required:
    - item_selector
    - fields
    - confidence
  properties:
    item_selector:
      type: string
    fields:
      type: object
      required:
        - name
        - price
      properties:
        name:
          type: object
          required:
            - selector
            - attribute
        price:
          type: object
          required:
            - selector
            - attribute
        url:
          type: object
        image:
          type: object
    confidence:
      type: number
      minimum: 0
      maximum: 1
    reasoning:
      type: string

# Quality gates
quality_gates:
  schema_validation: true
  confidence_threshold: 0.4
  max_retries: 2

description: |
  Creates extraction schemas for retail page product extraction.

  Analyzes page structure (repeated elements, sample HTML) to generate
  CSS selectors for extracting product name, price, URL, and image.

  Input: site_intent + page_context + previous_schema (optional)
  Output: extraction_schema.json with item_selector and field selectors

integration:
  invoked_by:
    - calibrator.llm_calibrator._build_schema_prompt
  invocation_point: during_page_calibration
