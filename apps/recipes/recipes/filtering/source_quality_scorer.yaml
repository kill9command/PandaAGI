# Source Quality Scorer Recipe
# Scores search results for source quality and relevance
#
# Used to prioritize which sources to visit during research

name: filtering_source_quality_scorer
category: filtering
role: source_quality_scorer
model_layer: REFLEX  # Classification (temp 0.1)

# Prompt fragments
prompt_fragments:
  - "apps/prompts/filtering/source_quality_scorer.md"

# Input documents
input_docs:
  - path: "goal"
    path_type: "runtime"
    optional: false
    max_tokens: 200
    description: "User's research goal"

  - path: "query"
    path_type: "runtime"
    optional: false
    max_tokens: 200
    description: "Original search query"

  - path: "requirements"
    path_type: "runtime"
    optional: true
    max_tokens: 300
    description: "Key requirements from user (optional)"

  - path: "candidates"
    path_type: "runtime"
    optional: false
    max_tokens: 2500
    description: "Search result candidates (url, title, snippet)"

# Output document
output_doc:
  path: "quality_scores.json"
  path_type: "temp"

# Token budget
token_budget:
  total: 4500
  prompt: 1000
  input_docs: 3000
  output: 1200
  buffer: 0

# Output schema
output_schema:
  type: object
  required:
    - results
  properties:
    results:
      type: array
      items:
        type: object
        required:
          - index
          - source_type
          - llm_quality_score
          - confidence
          - reasoning
        properties:
          index:
            type: integer
          source_type:
            type: string
            enum: ["official", "expert_review", "forum", "vendor", "news", "video", "social", "unknown"]
          llm_quality_score:
            type: number
            minimum: 0
            maximum: 1
          confidence:
            type: number
            minimum: 0
            maximum: 1
          reasoning:
            type: string

# Quality gates
quality_gates:
  schema_validation: true
  max_retries: 2

description: |
  Scores search results for source quality and relevance.

  Source types: official, expert_review, forum, vendor, news, video, social, unknown
  Quality score: 0.0-1.0 based on source reliability and goal relevance

  Input: goal + query + requirements + candidates
  Output: quality_scores.json with results array

integration:
  invoked_by:
    - source_quality_scorer.SourceQualityScorer.score_candidates
  invocation_point: after_search_before_visiting
