# Query Sanitizer Recipe
# Simplifies natural language queries for retailer search
#
# Converts conversational queries to simple keyword searches
# that work well with retailer site search.

name: research_query_sanitizer
category: research
role: query_sanitizer
model_layer: REFLEX  # Classification/extraction uses REFLEX (temp 0.3)

# Prompt fragments (loaded in order)
prompt_fragments:
  - "apps/prompts/research/query_sanitizer.md"

# Input documents
input_docs:
  - path: "query"
    path_type: "runtime"
    optional: false
    max_tokens: 200
    description: "Natural language query to sanitize"

# Output document
output_doc:
  path: "sanitized_query.txt"
  path_type: "temp"

# Token budget
token_budget:
  total: 400
  prompt: 200       # query_sanitizer.md prompt
  input_docs: 200   # query
  output: 50        # sanitized query
  buffer: 30

# Trimming strategy
trimming_strategy:
  method: truncate_end
  priority:
    - keep: query

# Output schema
output_schema:
  type: string
  description: "Simplified search terms (2-5 words)"

# Quality gates
quality_gates:
  schema_validation: false  # Plain text output
  max_retries: 1

# Description
description: |
  Query Sanitizer converts conversational queries to retailer-friendly searches.

  **Removes:**
  - Conversational phrases (find me, can you, please)
  - Commerce phrases (for sale, cheap, best price)

  **Keeps:**
  - Product names and brands
  - Key specifications
  - Brand casing (NVIDIA, RTX, AMD)

  Input: Natural language query
  Output: 2-5 word search terms

# Integration
integration:
  invoked_by:
    - query_planner.simplify_query_for_retailers_async
  invocation_point: before_retailer_site_search
